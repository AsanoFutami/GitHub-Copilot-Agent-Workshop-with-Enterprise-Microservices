# APIゲートウェイサービス

スキーショップECプラットフォームの統合APIゲートウェイ

## 主な提供機能

### 機能一覧

- **リクエストルーティング**: URLパターンに基づくバックエンドマイクロサービスへのインテリジェントなルーティング
- **認証・認可**: JWTベースの認証とロールベースアクセス制御
- **レートリミット**: Redisを用いたレート制限で不正利用防止と公平な利用を実現
- **サーキットブレーカー**: Resilience4jによる障害伝播防止
- **リクエスト/レスポンス変換**: ヘッダー操作、パス書き換え、内容フィルタリング
- **監視・可観測性**: メトリクス収集、分散トレーシング、ヘルスチェック
- **APIドキュメント**: 全サービスのSwagger UIを集約
- **CORS対応**: Webアプリ向けクロスオリジン設定
- **イベントストリーミング**: Kafka連携によるゲートウェイイベント・メトリクス配信
- **ロードバランシング**: 複数サービスインスタンスへのトラフィック分散

## サービスエンドポイント

| HTTPメソッド | エンドポイント | 説明 | 認証 |
|-------------|----------|-------------|-------|
| GET | `/actuator/health` | ヘルスチェック | なし |
| GET | `/actuator/info` | サービス情報 | なし |
| GET | `/actuator/metrics` | Prometheusメトリクス | 管理者のみ |
| GET | `/actuator/gateway/routes` | ルート設定 | 管理者のみ |
| GET | `/actuator/gateway/filters` | フィルター設定 | 管理者のみ |
| GET | `/swagger-ui.html` | APIドキュメント | なし |
| GET | `/api-docs` | OpenAPI仕様 | なし |

### ルーティング先サービス例

| パスパターン | 対象サービス | ポート | 認証 | ロール |
|--------------|--------------|------|------|------|
| `/api/auth/**` | 認証サービス | 8080 | なし | - |
| `/api/users/**` | ユーザー管理サービス | 8081 | 必須 | 任意認証済み |
| `/api/products/**` | 在庫管理サービス | 8082 | なし | - |
| `/api/inventory/**` | 在庫管理サービス | 8082 | 必須 | ADMIN, MANAGER |
| `/api/orders/**` | 売上管理サービス | 8083 | 必須 | 任意認証済み |
| `/api/reports/**` | 売上管理サービス | 8083 | 必須 | ADMIN, MANAGER |
| `/api/cart/**` | 決済・カートサービス | 8084 | 必須 | 任意認証済み |
| `/api/payments/**` | 決済・カートサービス | 8084 | 必須 | 任意認証済み |
| `/api/points/**` | ポイントサービス | 8085 | 必須 | 任意認証済み |
| `/api/coupons/**` | クーポンサービス | 8086 | 一部 | エンドポイントごとに異なる |
| `/api/recommendations/**` | AIサポートサービス | 8087 | なし | - |
| `/api/search/**` | AIサポートサービス | 8087 | なし | - |
| `/api/chat/**` | AIサポートサービス | 8087 | 必須 | 任意認証済み |
| `/api/analytics/**` | AIサポートサービス | 8087 | 必須 | ADMIN, MANAGER |

## 技術スタック

- **Java**: 21 LTS
- **Spring Boot**: 3.5.3
- **Spring Cloud Gateway**: 2025.0.0（リアクティブAPIゲートウェイ）
- **Spring Security**: 6.x（認証・認可）
- **Redis**: 7.2+（レートリミット・キャッシュ）
- **Apache Kafka**: 7.4+（イベントストリーミング）
- **Resilience4j**: 最新（サーキットブレーカー）
- **Micrometer**: 最新（メトリクス収集）
